#!/bin/bash

# Set up cross-compilation environment
export CC=x86_64-w64-mingw32-gcc
export CXX=x86_64-w64-mingw32-g++
export WINDRES=x86_64-w64-mingw32-windres
export AR=x86_64-w64-mingw32-ar
export RANLIB=x86_64-w64-mingw32-ranlib

# Create build directory
mkdir -p exploit_build
cd exploit_build

# Compile the exploit
$CXX -std=c++17 \
    -static-libgcc -static-libstdc++ \
    -o IotSenderExploit.exe \
    ../IotSenderExploit.cpp

# Check if compilation was successful
if [ $? -eq 0 ]; then
    echo "Compilation successful!"
    echo "Binary created: exploit_build/IotSenderExploit.exe"
    
    # Create a zip file with the binary
    echo "Creating distribution package..."
    mkdir -p ../exploit_dist
    cp IotSenderExploit.exe ../exploit_dist/
    cd ../exploit_dist
    zip -r IotSenderExploit_Windows.zip IotSenderExploit.exe
    echo "Distribution package created: exploit_dist/IotSenderExploit_Windows.zip"
else
    echo "Compilation failed!"
    exit 1
fi 
